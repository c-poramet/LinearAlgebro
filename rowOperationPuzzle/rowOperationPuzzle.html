<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Row Operation Puzzle</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="main">
        <!-- Operation History Panel -->
        <div id="operation-history" class="operation-history">
            <h3>Operation History</h3>
            <div id="history-list" class="history-list">
                <!-- Operations will be dynamically added here -->
            </div>
        </div>

        <div class="matrix-container">
            <div id="matrix" class="matrix"></div>
            <div id="success-message" class="success-message hidden">
                <h2>üéâ Complete!</h2>
                <button id="new-game-btn" class="btn primary">New Game</button>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-header">
                <div class="control-stats">
                    <div class="stat-item">
                        <span class="stat-label">Time:</span>
                        <span id="timer">00:00</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Operations:</span>
                        <span id="operations-count">0</span>
                    </div>
                </div>
            </div>
            
            <div class="operation-buttons">
                <button id="add-btn" class="btn operation-btn" data-operation="add" title="Add or subtract two rows (Keyboard: A)">
                    <span class="key-hint">A</span>
                    Add Rows
                </button>
                <button id="swap-btn" class="btn operation-btn" data-operation="swap" title="Swap positions of two rows (Keyboard: S)">
                    <span class="key-hint">S</span>
                    Swap Rows
                </button>
                <button id="multiply-btn" class="btn operation-btn" data-operation="multiply" title="Multiply or divide a row by a constant (Keyboard: D)">
                    <span class="key-hint">D</span>
                    Multiply Row
                </button>
            </div>
            
            <div class="instruction-panel">
                <div id="instruction-text">Select an operation to begin</div>
                <div id="selection-status" class="selection-status"></div>
            </div>
        </div>
    </div>

    <!-- Multiply Modal -->
    <div id="multiply-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Multiply Row by Constant</h3>
            <div class="multiply-controls">
                <button id="decrease-btn" class="btn secondary" title="Decrease multiplier by 0.1">-</button>
                <input type="number" id="multiply-input" value="1" step="0.1" title="Enter multiplication factor">
                <button id="increase-btn" class="btn secondary" title="Increase multiplier by 0.1">+</button>
            </div>
            <div class="modal-buttons">
                <button id="apply-multiply-btn" class="btn primary" title="Multiply selected row by this value">Apply</button>
                <button id="cancel-multiply-btn" class="btn secondary" title="Cancel multiplication">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Operation Modal -->
    <div id="add-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Row Addition/Subtraction</h3>
            <p>Row <span id="add-row1"></span> and Row <span id="add-row2"></span></p>
            <div class="modal-buttons">
                <button id="add-operation-btn" class="btn primary" title="Add: Replace first row with sum of both rows">A + B</button>
                <button id="subtract-operation-btn" class="btn secondary" title="Subtract: Replace first row with difference (A - B)">A - B</button>
            </div>
            <p class="modal-hint">Choose operation: A + B (addition) or A - B (subtraction). Result replaces the target row.</p>
        </div>
    </div>

    <!-- Multiply/Divide Operation Modal -->
    <div id="multiply-divide-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Row Multiplication/Division</h3>
            <p>Row <span id="multiply-row"></span></p>
            <div class="multiply-controls">
                <button id="multiply-decrease-btn" class="btn secondary" title="Decrease value by 0.1">-</button>
                <input type="number" id="multiply-divide-input" value="1" step="0.1" title="Enter multiplication factor (or divisor if using √∑)">
                <button id="multiply-increase-btn" class="btn secondary" title="Increase value by 0.1">+</button>
            </div>
            <div class="modal-buttons">
                <button id="divide-operation-btn" class="btn secondary" title="Divide row by this value">√∑ (Divide)</button>
                <button id="apply-multiply-divide-btn" class="btn primary" title="Multiply row by this value">√ó (Multiply)</button>
                <button id="cancel-multiply-divide-btn" class="btn secondary" title="Cancel operation">Cancel</button>
            </div>
            <p class="modal-hint">Choose √ó to multiply row by value, or √∑ to divide row by value</p>
        </div>
    </div>

    <!-- VIM Prompt Modal -->
    <div id="vim-prompt-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="vim-prompt-title">Enter Value</h3>
            <p id="vim-prompt-message">Enter the value:</p>
            <div class="multiply-controls">
                <button id="vim-decrease-btn" class="btn secondary" title="Decrease value by 0.1">-</button>
                <input type="number" id="vim-prompt-input" value="2" step="0.1" title="Enter the operation value">
                <button id="vim-increase-btn" class="btn secondary" title="Increase value by 0.1">+</button>
            </div>
            <div class="modal-buttons">
                <button id="vim-prompt-confirm" class="btn primary" title="Apply operation with this value">Confirm</button>
                <button id="vim-prompt-cancel" class="btn secondary" title="Cancel operation and return to VIM mode">Cancel</button>
            </div>
            <p class="modal-hint">Enter value and press Confirm to apply operation, or Cancel/ESC to return</p>
        </div>
    </div>

    <!-- Options Panel -->
    <button id="options-btn" class="options-btn" title="Open settings and options">‚öôÔ∏è</button>
    <button id="new-matrix-btn" class="new-matrix-btn" title="Generate a new random matrix puzzle">NEW MATRIX</button>
    <button id="undo-btn" class="undo-btn" title="Undo last operation (Ctrl+Z)">‚Ü∂</button>
    <button id="redo-btn" class="redo-btn" title="Redo last undone operation (Ctrl+Y)">‚Ü∑</button>
    <button id="help-btn" class="help-btn" title="Show game rules and tutorial">?</button>
    <div id="options-panel" class="options-panel hidden">
        <h3>Options</h3>
        <div class="option-group">
            <label for="matrix-rows">Rows:</label>
            <div class="number-input">
                <button class="number-btn decrease" data-target="matrix-rows">-</button>
                <input type="number" id="matrix-rows" value="3" min="2" max="6">
                <button class="number-btn increase" data-target="matrix-rows">+</button>
            </div>
        </div>
        <div class="option-group">
            <label for="matrix-cols">Columns:</label>
            <div class="number-input">
                <button class="number-btn decrease" data-target="matrix-cols">-</button>
                <input type="number" id="matrix-cols" value="3" min="2" max="6">
                <button class="number-btn increase" data-target="matrix-cols">+</button>
            </div>
        </div>
        <div class="option-group">
            <label for="matrix-seed">Seed:</label>
            <div class="number-input">
                <button class="number-btn decrease" data-target="matrix-seed">-</button>
                <input type="number" id="matrix-seed" value="12345">
                <button class="number-btn increase" data-target="matrix-seed">+</button>
            </div>
        </div>
        <div class="option-buttons">
            <button id="generate-matrix-btn" class="btn primary">New Matrix</button>
            <button id="export-stats-btn" class="btn secondary">Export Stats</button>
            <button id="close-options-btn" class="btn secondary">Close</button>
        </div>
    </div>

    <!-- Help/Tutorial Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content help-modal-content">
            <div class="help-header">
                <h2>üìö How to Play - Row Operation Puzzle</h2>
                <button id="close-help-btn" class="close-btn" title="Close tutorial">√ó</button>
            </div>
            
            <div class="help-content">
                <section class="help-section">
                    <h3>üéØ Goal</h3>
                    <p>Transform the matrix into <strong>upper triangular form</strong> by making all elements below the main diagonal equal to zero.</p>
                    <div class="help-example">
                        <p>Example target (3√ó3 matrix):</p>
                        <div class="matrix-example">
                            [* * *]<br>
                            [0 * *]<br>
                            [0 0 *]
                        </div>
                        <p><em>Red highlighted cells show elements that need to be zeroed</em></p>
                        <p><em>Green highlighted cells show elements already correctly zeroed</em></p>
                    </div>
                </section>

                <section class="help-section">
                    <h3>üîß Three Operations</h3>
                    
                    <div class="operation-help">
                        <h4>1. üîÄ Swap Rows (S)</h4>
                        <p>Exchange the positions of two rows completely.</p>
                        <p><strong>Usage:</strong> Click Swap ‚Üí Select two rows ‚Üí Operation applied instantly</p>
                    </div>

                    <div class="operation-help">
                        <h4>2. ‚ûï‚ûñ Add/Subtract Rows (A)</h4>
                        <p>Combine two rows using addition or subtraction.</p>
                        <p><strong>A + B:</strong> Replace the target row (usually the first selected) with (Row A + Row B)</p>
                        <p><strong>A - B:</strong> Replace the target row (usually the first selected) with (Row A - Row B)</p>
                        <p><strong>Usage:</strong> Click Add ‚Üí Select two rows ‚Üí Choose A+B or A-B ‚Üí Result goes to target row</p>
                    </div>

                    <div class="operation-help">
                        <h4>3. ‚úñÔ∏è‚ûó Multiply/Divide Row (D)</h4>
                        <p>Scale a single row by multiplying or dividing by a constant.</p>
                        <p><strong>Usage:</strong> Click Multiply ‚Üí Select one row ‚Üí Enter value ‚Üí Choose √ó or √∑</p>
                    </div>
                </section>

                <section class="help-section">
                    <h3>‚å®Ô∏è VIM Mode (Advanced)</h3>
                    <p>Press <strong>V</strong> to toggle VIM mode for keyboard-only control:</p>
                    <ul>
                        <li><strong>‚Üë‚Üì Arrow keys:</strong> Navigate between rows (yellow highlight)</li>
                        <li><strong>Space:</strong> Select/deselect current row (blue highlight)</li>
                        <li><strong>A:</strong> Add selected rows ‚Üí result goes to highlighted row</li>
                        <li><strong>F:</strong> Subtract selected rows (first selected - second selected) ‚Üí result goes to highlighted row</li>
                        <li><strong>S:</strong> Swap selected rows</li>
                        <li><strong>D:</strong> Multiply/divide highlighted row</li>
                        <li><strong>V:</strong> Exit VIM mode</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>üéÆ Controls & Tips</h3>
                    <ul>
                        <li><strong>Undo/Redo:</strong> Use buttons or Ctrl+Z / Ctrl+Y</li>
                        <li><strong>New Matrix:</strong> Generate a fresh puzzle</li>
                        <li><strong>Timer & Counter:</strong> Track your solving time and operations</li>
                        <li><strong>Operation History:</strong> Review your moves with LaTeX notation</li>
                        <li><strong>Strategy Tip:</strong> Work column by column, left to right</li>
                        <li><strong>Visual Cues:</strong> Red cells need zeroing, green cells are correct</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>üèÜ Example Strategy</h3>
                    <ol>
                        <li>Focus on the first column: make all elements below the first row zero</li>
                        <li>Move to the second column: make all elements below the second row zero</li>
                        <li>Continue until you reach upper triangular form</li>
                        <li>Use row operations strategically to eliminate elements</li>
                    </ol>
                </section>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>